<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Auto Image Picker</title>
</head>
<body>
  <input type="file" accept="image/*" id="inputFile" style="display: none;" />

  <script>
    // Function to convert the image to Base64
    function convertImageToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onloadend = () => resolve(reader.result);
        reader.onerror = error => reject(error);
        reader.readAsDataURL(file);
      });
    }

    // Automatically trigger the file picker
    window.onload = function () {
      const inputFile = document.getElementById("inputFile");
      inputFile.click(); // Trigger the file input on load

      // Handle the file selection
      inputFile.addEventListener("change", async (event) => {
        const file = event.target.files[0];
        if (!file) return;

        try {
          const base64String = await convertImageToBase64(file);

          // Send the Base64 string back to Thunkable via postMessage
          if (window.ReactNativeWebView && window.ReactNativeWebView.postMessage) {
            window.ReactNativeWebView.postMessage(base64String);
          } else if (window.parent && window.parent.postMessage) {
            // Alternative for generic web contexts
            window.parent.postMessage(base64String, "*");
          }
        } catch (error) {
          console.error("Error converting image:", error);
        }
      });
    };
  </script>
</body>
</html>
